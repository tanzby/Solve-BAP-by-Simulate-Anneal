# Solve-BAP-by-Simulate-Anneal
使用模拟退火的方法解决船舶分配问题

# 文件包含

BAP.cpp 为主文件
Vessel.h 为管理船只库文件
VesselSolve.h 为方法集合，目前里面有暴力与模拟退火算法

# 算法说明
## 编码状态
### 序列表示
  将船只的id进行编排成序列之后，每次按顺序取出一艘船往左上角放置，可以唯一地确定一个BAP解决方案；这是一个充分条件。
### 序列放置
  假如我们使用的array为{0,1,2,3,4}, 那么船只将按照这一个排列方式进行船舶的停靠。首先是0号船将从(0,0)(横坐标为时间线，纵坐标为港口长度)的位置开始寻找可停靠的位置，优先判断在时间线t_i上，是否存在空余位置（纵轴，从b_i开始的位置）给0号船只停泊，即判断以(t_i,b_i )和(t_i+s_i,b_i+l_i)为对角的矩形区域是否超出了有效停靠区、是否已经被其他船只占用。当两个条件满足后船只将被停在(t_i,b_i )位置
## 应用贪心算法
按 **时间优先** ，**长度次之** 的 方法进行序列排列，然后依照上一节的方法进行船只放置
## 应用模拟退火
  贪心算法中，我们应用一定的规则生成一个放置排序数组，然后将船舶放置进去，这种做法并不能保证费用能得到优化。在此，我们使用启发式算法模拟退火，对序列进行选择，更新。在模拟退火中，将会从定义的搜索空间中通过一定的状态转移规律进行可行解的搜索，状态产生函数（邻域函数）应尽可能保证产生的候选解遍布全部解空间。这通常由两部分组成，即产生候选解的方式和候选解产生的概率分布。在BAP问题中，“转移”即为一个停泊序列向另一个停泊序列的转移。在转移的过程中，我们采用Metropolis接受准则来决定时候接收新的解。
### 初始序列
  模拟退火中的初始化序列在一定程度上可以影响解空间的搜索，如果不小心落入了局部最优解，那将大大减少了找到最优解的概率。不失一般性，我使用“到达时间”为基准进行一个预排序，然后调用模拟退火程序进行求解
### 产生临近解及评估
  临界解的产生有多种方法，在这里，交换序列中两个位置的值以产生新序列方法将被使用。如{0,1,2,3,4}序列经过一次邻居变换可以得到邻居解{0,4,2,3,1}。然后，我们使用1.2的方法进行船只的放置，在放置的过程中，将会统计船只被成功放置的数量、成功放置船只的等待时间、成功放置船只的最后离开时间，之后，使用公式(1)评估新新邻居解。在评估完成之后，采用Metropolis接受准则来决定时候接收新的解。如果新解评估结果比当前最小解好，那么解将被接受；如果没有小于，假设此时的温度是Tem，费用差为dE，我们使用p=exp⁡(-dE/Tem)来产生接受新解的概率，根据这个概率来判断是否接受新的解。
### 参数处理与进阶求解
  在开始求解BAP问题前，我们会先定义模拟退火时的初始温度。初始温度和退火率会影响到局部最优解的跳出与更新快慢。在初始温度比较大时，较容易跳出局部最优解，但是也容易使得最优解丢失；当初始温度比较低时，容易向着一个方向走。经过多次实验，可以发现，当初始温度在50°左右时最为合适。、为此，可以采用多条路线同时退火的方式。即开辟一个容器装着最优的一组解，每次进行一轮的退火时，分别从其中取出序列进行近邻搜索，按照Metropolis接受准则更新容器中的解。 也可以将多次的退火过程串联起来，即将上一次的退火结果当成下次的初始序列，这样做可以提高获得最优解的概率。
